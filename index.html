<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡∏ô‡πÇ‡∏Å‡πâ‡∏á‡πÜ‡∏ù‡∏∂‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå - ‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏ñ‡∏∂‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</title>
    <link rel="icon" type="image/png" href="https://img2.pic.in.th/imageae5557eb3dd57c75.png">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff0000;
            --bg: #64677ecb;
            --card: #000000;
            --text-dark: #1e293b;
            --text-light: #94a3b8;
            --highlight: #ffd43b;
        }

        body {
            background-color: var(--bg);
            font-family: 'Sarabun', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-dark);
        }

        .main-container { width: 95%; max-width: 1100px; text-align: center; display: none; position: relative; }

        .top-actions { position: absolute; top: -50px; right: 0; display: flex; gap: 10px; }
        .btn-top { background: #333; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 14px; }

        h1 { font-weight: 700; color: var(--primary); margin-bottom: 30px; letter-spacing: -1px; }

        .typing-card {
            background: var(--card); padding: 50px; border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4); margin-bottom: 30px; position: relative;
        }

        .display-window { height: 140px; overflow: hidden; position: relative; margin-bottom: 40px; }
        
        #wordContainer {
            position: absolute; top: 0; left: 0; width: 100%; display: flex; flex-wrap: wrap;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); text-align: left;
        }

        .word { font-size: 44px; line-height: 75px; margin-right: 18px; color: var(--text-light); padding: 0 12px; border-radius: 8px; transition: all 0.2s; }
        .word.current { background-color: var(--highlight); color: #000; font-weight: 600; box-shadow: 0 4px 12px rgba(255, 212, 59, 0.4); }
        .word.correct { color: white; }
        .word.wrong { color: #ef4444; text-decoration: line-through; }

        .controls-row { display: flex; gap: 20px; align-items: center; }
        #userInput {
            flex: 1; font-family: 'Sarabun', sans-serif; font-size: 28px; padding: 18px 25px;
            border: 2px solid #e2e8f0; border-radius: 16px; outline: none; background: #f1f5f9;
        }

        .timer-badge { background: var(--primary); color: white; padding: 15px 35px; border-radius: 16px; font-size: 32px; font-weight: 700; min-width: 70px; }
        .btn-refresh { background: #fff; border: 2px solid #e2e8f0; width: 70px; height: 70px; border-radius: 16px; cursor: pointer; font-size: 28px; color: var(--text-light); }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }

        .modal-card {
            background: white; width: 90%; max-width: 550px; padding: 40px;
            border-radius: 30px; text-align: center; max-height: 85vh; overflow-y: auto;
        }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .stat-box { background: #f8fafc; padding: 12px; border-radius: 15px; border: 1px solid #eee; }
        .stat-val { font-size: 28px; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 13px; color: #64748b; }

        .rank-badge { background: #ffd43b; color: #000; padding: 10px 25px; border-radius: 50px; font-weight: 700; font-size: 18px; margin-bottom: 10px; display: inline-block; }

        .rank-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; text-align: left; }
        .rank-table tr { border-bottom: 1px solid #eee; }
        .rank-table td, .rank-table th { padding: 10px; }
        .active-rank { background: #fff1f2; font-weight: bold; }

        #authSection { background: #000; padding: 40px; border-radius: 24px; width: 320px; text-align: center; color: white; }
        .auth-input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #111; color: white; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .sync-status { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>

<div id="authSection">
    <h2 style="color:red">‚å®Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏Å‡πâ‡∏á‡πÜ</h2>
    <input type="text" id="usernameInput" class="auth-input" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏°‡∏∂‡∏á‡∏Å‡∏π‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å">
    <input type="password" id="passwordInput" class="auth-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏°‡∏∂‡∏á ‡∏à‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏•‡πà‡∏∞">
    <button class="btn-main" onclick="handleAuth()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏Å‡πâ‡∏á‡πÜ‡πÄ‡∏•‡∏¢‡πÜ</button>
</div>

<div class="main-container" id="gameMain">
    <div class="top-actions">
        <button class="btn-top" onclick="showRanking()">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏û‡∏ß‡∏Å‡πÇ‡∏Å‡πâ‡∏á‡πÜ</button>
        <button class="btn-top" onclick="handleLogout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    
    <div style="display:flex; justify-content: space-between; margin-bottom: 10px; color: white; font-size: 14px;">
        <span>üë§ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏Å‡πâ‡∏á‡πÜ: <b id="displayUser" style="color:var(--highlight)"></b></span>
        <span>üèÜ ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏∂‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ: <b id="bestWPM" style="color:var(--highlight)">0</b> WPM</span>
    </div>

    <h1>‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏î‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÇ‡∏Å‡πâ‡∏á‡πÜ ‡∏ß‡πà‡∏≤‡∏á‡πÜ</h1>

    <div class="typing-card">
        <div class="display-window">
            <div id="wordContainer"></div>
        </div>
        <div class="controls-row">
            <input type="text" id="userInput" placeholder="‡∏£‡∏µ‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå ‡∏≠‡∏¢‡πà‡∏≤‡πÅ‡∏≠‡πá‡∏Ñ" autocomplete="off">
            <div class="timer-badge" id="timer">60</div>
            <button class="btn-refresh" onclick="resetGame()">‚Üª</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="resultModal">
    <div class="modal-card">
        <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏°‡∏∂‡∏á</h2>
        <div class="rank-badge" id="resRankBadge">‡∏£‡∏∞‡∏î‡∏±‡∏ö</div>
        
        <div class="stats-grid">
            <div class="stat-box"><div class="stat-label">WPM</div><div class="stat-val" id="resWpm">0</div></div>
            <div class="stat-box"><div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÄ‡∏´‡∏¢‡∏î‡πÜ</div><div class="stat-val" id="resAcc">0%</div></div>
            <div class="stat-box"><div class="stat-label">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏π‡∏Å‡πÄ‡∏ó‡∏û‡∏ß‡πà‡∏∞ (‡∏Ñ‡∏≥)</div><div class="stat-val" style="color:#10b981" id="resCorrect">0</div></div>
            <div class="stat-box"><div class="stat-label">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡∏Å‡∏≤‡∏Å‡∏™‡∏±‡∏™ (‡∏Ñ‡∏≥)</div><div class="stat-val" style="color:#ef4444" id="resWrong">0</div></div>
            <div class="stat-box" style="grid-column: span 2;"><div class="stat-label">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡πÇ‡∏Å‡πâ‡∏á‡πÜ‡πÑ‡∏õ (‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div><div class="stat-val" style="color:#3b82f6" id="resAttempts">0</div></div>
        </div>

        <div id="syncStatus" class="sync-status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏∞‡πÑ‡∏≠‡πâ‡∏™‡∏±‡∏™</div>
        <button class="btn-main" onclick="resetGame()">‡∏Å‡πá‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏î‡∏¥‡∏ß‡∏∞</button>
    </div>
</div>

<div class="modal-overlay" id="rankingModal">
    <div class="modal-card">
        <h2>üìä ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Å‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏Å‡∏π</h2>
        <table class="rank-table">
            <thead><tr><th>#</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>WPM</th><th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th></tr></thead>
            <tbody id="lbBody"></tbody>
        </table>
        <button class="btn-main" style="background:#666; margin-top:20px;" onclick="closeModal('rankingModal')">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<script>
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï URL ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw0JR-Rrt05HcgmGuOSbHB0GC4eeMCt4TQwWvAdbv6bHuOxmejpAnh2vSNl1Jdv6VEv/exec";
    
    const fullWordList = ["‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô","‡∏î‡∏≤‡∏ß‡∏ï‡∏Å","‡∏ö‡∏¥‡∏ô","‡πÇ‡∏™‡∏°","‡πÅ‡∏™‡∏á","‡πÇ‡∏ï","‡πÉ‡∏´‡∏ç‡πà","‡∏ô‡πâ‡∏≠‡∏¢","‡∏ú‡∏≠‡∏°","‡∏≠‡πâ‡∏ß‡∏ô","‡∏≠‡πâ‡∏≠‡∏ô","‡πÅ‡∏î‡∏á","‡πÄ‡∏û‡∏•‡∏á","‡∏´‡∏≠‡∏°","‡∏ï‡πà‡∏≠","‡πÄ‡∏ï‡∏¥‡∏°","‡∏´‡πâ‡∏≤‡∏°","‡πÄ‡∏ä‡πá‡∏Ñ","‡πÄ‡∏ä‡∏∑‡∏≠‡∏î","‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô","‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å","‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å","‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å","‡∏û‡∏£‡πâ‡∏≠‡∏°","‡∏™‡∏≥‡∏≠‡∏≠‡∏¢","‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î","‡∏ñ‡∏π‡∏Å","‡∏ú‡∏¥‡∏î","‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©","‡∏û‡πà‡∏≠‡∏á","‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î","‡∏õ‡πà‡∏ß‡∏¢","‡∏´‡∏ß‡∏¢","‡∏´‡∏°‡∏≤","‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","‡∏°‡∏±‡∏á‡∏Å‡∏£","‡∏á‡∏±‡∏ö","‡∏°‡∏≠‡∏á","‡∏î‡∏≤‡∏ß","‡∏™‡∏ï‡∏≤‡∏£‡πå","‡πÑ‡∏û‡∏•‡∏¥‡∏ô","‡∏õ‡∏≠‡∏¢","‡∏°‡∏î","‡∏û‡∏¢‡∏≤‡∏û‡∏≤‡∏°","‡πÉ‡∏à","‡∏´‡∏±‡∏ß","‡∏Å‡∏≥","‡∏´‡∏°‡∏±‡∏î","‡∏ä‡∏Å","‡∏´‡∏°‡∏±‡∏î","‡πÄ‡∏´‡∏µ‡πâ‡∏¢","‡πÄ‡∏™‡∏∑‡∏≠‡∏Å","‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ","‡∏à‡∏ô","‡∏ô‡∏£‡∏Å","‡∏°‡∏≤‡∏£","‡∏î‡∏≠‡∏Å","‡∏Å‡∏ö","‡πÅ‡∏°‡∏ß","‡∏Å‡πâ‡∏≠‡∏¢","‡∏Å‡∏•‡πâ‡∏≤‡∏°","‡πÇ‡∏Å‡πâ‡∏á","‡∏´‡∏°‡∏≤","‡∏´‡∏°‡∏µ","‡∏´‡∏°‡∏ß‡∏¢","‡∏™‡∏≤‡∏ß","‡∏´‡∏ô‡∏∏‡πà‡∏°","‡∏û‡∏π‡∏î","‡∏•‡∏≤‡∏ö","‡πÅ‡∏ï‡∏î","‡∏´‡∏ô‡πà‡∏≠","‡∏´‡∏•‡πà‡∏≠","‡∏ó‡∏£‡∏≤‡∏ö","‡∏ó‡∏£‡∏≤‡∏¢","‡∏ö‡∏≤‡∏á","‡πÑ‡∏Å‡πà","‡∏õ‡∏•‡∏≤","‡∏ï‡πâ‡∏°","‡∏á‡∏á","‡∏õ‡∏•‡∏≠‡∏°","‡πÅ‡∏ó‡πâ","‡∏à‡∏£‡∏¥‡∏á","‡∏™‡∏¥‡∏ß","‡∏•‡∏¥‡∏á","‡∏™‡∏¥‡∏ö","‡πÄ‡∏Å‡πâ‡∏≤","‡∏´‡∏Å","‡∏´‡πâ‡∏≤","‡∏™‡∏µ‡πà","‡∏™‡∏≤‡∏°","‡∏™‡∏≠‡∏á","‡∏™‡∏¥‡∏á","‡∏´‡∏Å","‡∏Ñ‡∏ß‡∏≤‡∏¢","‡∏à‡πâ‡∏≤","‡∏Ç‡πâ‡∏≤","‡∏ü‡∏≤‡∏£‡πå‡∏°","‡∏¢‡∏≤","‡∏Å‡∏±‡∏ç‡∏ä‡∏≤","‡πÄ‡∏ô‡∏∑‡πâ‡∏≠","‡πÅ‡∏ó‡πâ","‡∏•‡∏≥","‡∏ó‡∏≠‡∏á","‡∏™‡πâ‡∏°","‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß","‡πÅ‡∏î‡∏á","‡πÄ‡∏î‡∏¢‡πå","‡∏û‡∏¥‡∏°‡∏û‡πå","‡∏ó‡πâ‡∏≠‡∏á","‡πÄ‡∏Å‡∏°","‡∏à‡∏≥","‡∏à‡∏≥‡∏ô‡∏≥","‡∏û‡∏£‡∏∞","‡∏â‡∏±‡∏ô","‡πÄ‡∏ò‡∏≠","‡πÄ‡∏ß‡∏£","‡πÄ‡∏û‡∏∑‡πà‡∏≠","‡πÄ‡∏´‡∏µ‡πâ‡∏¢","‡∏™‡∏±‡∏™","‡∏Ñ‡∏ß‡∏¢","‡∏´‡∏°‡∏µ","‡∏™‡∏µ","‡∏≠‡πâ‡∏≠","‡∏´‡∏°‡∏≠","‡∏´‡∏°‡πâ‡∏≠","‡∏á‡∏á","‡∏û‡∏≠","‡∏ó‡πà‡∏≠", "‡∏ä‡∏ß‡∏ô", "‡∏ó‡∏ß‡∏µ", "‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô", "‡∏ä‡∏≠‡∏ö", "‡πÇ‡∏Ñ‡∏°", "‡πÄ‡∏â‡∏û‡∏≤‡∏∞", "‡∏á‡∏≤‡∏ô", "‡∏ï‡∏£‡∏á", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏Ç‡∏∂‡πâ‡∏ô", "‡∏Ç‡∏ß‡∏≤‡∏á", "‡πÄ‡∏Å‡∏ì‡∏ë‡πå", "‡∏ä‡πâ‡∏≤", "‡∏Ñ‡∏π‡∏ì", "‡∏î‡∏á", "‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å", "‡πÄ‡∏ó‡πâ‡∏≤", "‡∏ã‡∏¥", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö", "‡∏ä‡∏µ‡∏û", "‡∏ä‡∏¥‡∏á", "‡∏à‡∏±‡∏ö", "‡∏ä‡∏±‡πà‡∏ß", "‡πÉ‡∏Å‡∏•‡πâ", "‡∏î‡πâ‡∏ß‡∏¢", "‡∏ï‡∏£‡∏ß‡∏à", "‡∏ó‡∏≥‡πÑ‡∏°", "‡∏Å‡∏•‡πâ‡∏≤", "‡∏ä‡∏±‡∏ß‡∏£‡πå", "‡∏â‡∏±‡∏ô", "‡∏Ñ‡∏•‡∏≤‡∏¢", "‡∏ò‡∏£‡∏£‡∏°", "‡∏Å‡∏•‡∏≤‡∏á", "‡∏ï‡∏±‡∏î", "‡∏ô‡∏±‡πà‡∏á", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô", "‡∏à‡∏£‡∏¥‡∏ï", "‡∏ó‡∏±‡πâ‡∏á", "‡∏ó‡πâ‡∏≠‡∏á", "‡πÉ‡∏ï‡πâ", "‡πÄ‡∏î‡∏∑‡∏≠‡∏î", "‡∏à‡∏≥", "‡πÅ‡∏î‡∏î", "‡∏ï‡∏≤‡∏°", "‡∏à‡∏∂‡∏á", "‡∏ï‡πâ‡∏ô", "‡∏ä‡πâ‡∏≤‡∏á", "‡∏ó‡∏±‡∏ô", "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠", "‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß", "‡∏Ñ‡∏±‡∏ö", "‡∏Å‡∏•‡πà‡∏≤‡∏ß", "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á", "‡πÇ‡∏ï‡πä‡∏∞", "‡∏Ñ‡∏•‡∏∏‡∏°", "‡∏ï‡∏£‡∏≤", "‡∏Ñ‡πà‡∏≤", "‡∏ó‡∏´‡∏≤‡∏£", "‡πÅ‡∏à‡πâ‡∏á", "‡∏Ç‡∏±‡∏á", "‡∏Ç‡∏≤‡∏î", "‡πÄ‡∏à‡∏£‡∏¥‡∏ç", "‡∏Ç‡πâ‡∏≤‡∏á", "‡∏Å‡∏ß‡πâ‡∏≤‡∏á", "‡∏î‡∏±‡∏ö", "‡∏ä‡∏≤‡∏ï‡∏¥", "‡πÑ‡∏Å‡∏•", "‡πÅ‡∏Å‡∏∞", "‡∏ï‡πà‡∏≠", "‡∏î‡∏ß‡∏á", "‡∏Ç‡∏≠‡∏ö", "‡∏ñ‡∏π‡∏Å", "‡πÅ‡∏ñ‡∏ß", "‡∏á‡∏≤‡∏°", "‡∏Ç‡∏≤", "‡πÉ‡∏Ñ‡∏£", "‡∏ï‡∏ô", "‡∏Ñ‡πà‡∏≥", "‡∏ä‡∏≤", "‡πÄ‡∏ï‡∏µ‡∏¢‡∏á", "‡πÅ‡∏à‡∏á", "‡∏î‡∏≥", "‡∏ó‡∏¥‡πâ‡∏á", "‡∏Ç‡∏¢‡∏≤‡∏¢", "‡∏à‡∏±‡∏Å", "‡∏î‡πâ‡∏≤‡∏ô", "‡∏ñ‡∏ß‡∏≤‡∏¢", "‡∏Ñ‡∏≠", "‡∏Å‡∏≤‡∏£", "‡∏ò‡∏á", "‡∏ä‡πà‡∏≠‡∏á", "‡πÄ‡∏Å‡∏¥‡∏ô", "‡∏î‡∏∑‡πà‡∏°", "‡∏ï‡∏¥‡∏î", "‡∏ï‡πâ‡∏≠‡∏á", "‡∏ä‡πà‡∏≤‡∏á", "‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥", "‡∏à‡∏ö", "‡∏Ñ‡∏ì‡∏∞", "‡∏ó‡∏¥‡∏®", "‡πÄ‡∏Ç‡∏≤", "‡∏à‡∏î", "‡∏ï‡∏π‡πâ", "‡πÄ‡∏Ñ‡∏¢", "‡∏Ñ‡∏∞", "‡∏ñ‡∏ô‡∏ô", "‡∏Ñ‡∏ß‡∏£", "‡∏Å‡∏¥‡∏ô", "‡∏Å‡∏µ‡πà", "‡∏Ç‡∏±‡∏î", "‡∏Å‡∏ß‡πà‡∏≤", "‡∏ä‡πà‡∏ß‡∏¢", "‡∏ã‡πâ‡∏≥", "‡∏ô‡∏≠‡∏ô", "‡∏î‡∏¥‡∏ô", "‡∏à‡∏á", "‡∏Å‡∏≤‡∏¢", "‡∏Å‡∏£‡∏∏‡∏á", "‡∏Ñ‡∏£‡∏≠‡∏á", "‡∏ã‡∏∂‡πà‡∏á", "‡πÇ‡∏ä‡∏Ñ", "‡πÄ‡∏î‡πá‡∏Å", "‡πÄ‡∏ä‡πà‡∏ô", "‡∏ã‡∏∑‡πà‡∏≠", "‡∏Ç‡∏µ‡πà", "‡∏à‡∏£‡∏¥‡∏á", "‡∏Ñ‡∏≠‡∏¢", "‡∏Ç‡∏ô", "‡∏Ñ‡∏î‡∏µ", "‡πÑ‡∏Ç", "‡πÇ‡∏î‡∏¢", "‡∏Ç‡∏±‡∏ô", "‡∏à‡∏≤‡∏Å", "‡πÅ‡∏ó‡∏ô", "‡∏Å‡∏≤", "‡∏ó‡∏µ", "‡πÅ‡∏ó‡πâ", "‡∏ó‡∏≤‡∏¢", "‡∏à‡∏¥‡∏ï", "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á", "‡∏Ç‡πâ‡∏≤‡∏°", "‡πÄ‡∏Å‡∏≤‡∏∞", "‡∏à‡∏°", "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", "‡∏ã‡πâ‡∏≤‡∏¢", "‡πÄ‡∏á‡∏¥‡∏ô", "‡∏Ñ‡∏ô", "‡∏ï‡∏≥", "‡∏Å‡∏π‡πâ", "‡∏ó‡πâ‡∏≤‡∏¢", "‡∏ä‡∏ô", "‡∏Å‡πà‡∏≠", "‡∏î‡∏µ", "‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡πÄ‡∏á‡∏µ‡∏¢‡∏ö", "‡πÄ‡∏Ç‡∏ï", "‡πÇ‡∏ó‡∏©", "‡∏Ñ‡∏ß‡∏≤‡∏°", "‡∏Ç‡πâ‡∏≤‡∏ß", "‡∏ä‡∏±‡∏Å", "‡∏à‡∏±‡∏á", "‡∏Ç‡∏ì‡∏∞", "‡∏Å‡∏±‡∏ô", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏Ç‡∏ß‡∏î", "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß", "‡∏à‡∏µ‡∏ô", "‡∏à‡∏∞", "‡πÉ‡∏ä‡πà", "‡∏ó‡∏≠‡∏î", "‡∏ï‡∏±‡πâ‡∏á", "‡∏Ñ‡∏£‡∏π", "‡∏ï‡∏±‡∏ß", "‡∏ï‡∏Å", "‡∏ñ‡∏≠‡∏¢", "‡πÄ‡∏ä‡πâ‡∏≤", "‡∏ô‡∏°", "‡∏Å‡πá", "‡∏î‡∏≤‡∏ß", "‡∏ó‡∏£‡∏á", "‡∏ó‡∏£‡∏≤‡∏ö", "‡∏ó‡∏≤", "‡∏ò‡∏≤‡∏ï‡∏∏", "‡∏ä‡∏ô‡∏∞", "‡∏Å‡πâ‡∏≠‡∏ô", "‡πÇ‡∏á‡πà", "‡πÅ‡∏Å‡πâ", "‡∏Ñ‡∏≥", "‡∏ï‡∏≤‡∏¢", "‡∏ô‡∏±‡∏Å", "‡∏Ñ‡πâ‡∏≤", "‡∏ä‡∏µ‡πâ", "‡∏Ñ‡∏∑‡∏ô", "‡πÅ‡∏ï‡∏Å", "‡πÑ‡∏î‡πâ", "‡∏ï‡πà‡∏≥", "‡πÑ‡∏Å‡πà", "‡∏á‡∏≠‡∏Å", "‡∏à‡πà‡∏≤‡∏¢", "‡∏Ñ‡πâ‡∏ô", "‡∏Ñ‡πà‡∏≠‡∏¢", "‡∏Ç‡∏≤‡∏¢", "‡∏Ç‡∏µ‡∏î", "‡∏Å‡∏•‡∏°", "‡∏ä‡∏±‡∏î", "‡πÄ‡∏î‡∏¥‡∏ô", "‡πÑ‡∏ó‡∏¢", "‡∏Ñ‡∏∑‡∏≠", "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï", "‡∏Ç‡πà‡∏≤‡∏ß", "‡∏ç‡∏≤‡∏ï‡∏¥", "‡∏ó‡∏∏‡∏Å‡∏Ç‡πå", "‡∏ä‡∏ô‡∏¥‡∏î", "‡∏à‡∏ô", "‡∏ó‡∏∞‡πÄ‡∏•", "‡πÄ‡∏ä‡∏∑‡πà‡∏≠", "‡πÄ‡∏ó", "‡πÉ‡∏ä‡πâ", "‡πÄ‡∏Å‡∏¥‡∏î", "‡∏Ç‡∏ô‡∏≤‡∏î", "‡∏Å‡∏£‡∏£‡∏°", "‡∏ñ‡πâ‡∏≤", "‡πÄ‡∏î‡∏¥‡∏°", "‡∏ä‡∏∑‡πà‡∏≠", "‡πÅ‡∏ï‡πà‡∏á", "‡∏ó‡∏∏‡πà‡∏á", "‡∏ó‡∏∏‡∏Å", "‡∏ä‡∏±‡πâ‡∏ô", "‡∏á‡πà‡∏≤‡∏¢", "‡∏Ç‡∏±‡∏ö", "‡∏ï‡∏•‡∏≠‡∏î", "‡∏ô‡∏≠‡∏Å", "‡∏ï‡∏•‡∏≤‡∏î", "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", "‡∏ñ‡∏≤‡∏°", "‡∏ï‡∏≤", "‡πÄ‡∏ñ‡∏µ‡∏¢‡∏á", "‡πÅ‡∏Å‡πâ‡∏ß", "‡πÄ‡∏à‡πá‡∏î", "‡πÄ‡∏à‡πâ‡∏≤", "‡∏Å‡∏£‡∏°", "‡∏ñ‡∏±‡πà‡∏ß", "‡∏Å‡∏•‡∏±‡∏ö", "‡πÅ‡∏î‡∏á"];

    let words = [], currentIdx = 0, timeLeft = 60, isStarted = false, timer = null;
    let correctCount = 0, wrongCount = 0, totalTypeAttempts = 0, totalChars = 0, correctChars = 0, currentUser = "";

    window.onload = function() {
        const savedUser = localStorage.getItem('isLoggedIn');
        if (savedUser) {
            currentUser = savedUser;
            let db = JSON.parse(localStorage.getItem('typingDB_Final') || '{}');
            showGame(savedUser, db[savedUser] ? db[savedUser].best : 0);
        }
    };

    function getRank(wpm) {
        if (wpm <= 30) return "üê¢ ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏´‡∏°‡∏ß‡∏∞ ‡∏Å‡∏≤‡∏Å‡∏ß‡πà‡∏∞";
        if (wpm <= 45) return "üê£ ‡πÇ‡∏´‡∏ô‡∏µ‡πà‡∏´‡∏±‡∏î‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏≠? ‡πÄ‡∏≠‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏î‡∏¥‡πÜ";
        if (wpm <= 58) return "üêé ‡πÄ‡∏´‡∏¢‡∏î‡πÜ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡πà‡∏á‡∏•‡∏∞‡∏ß‡πà‡∏∞ ‡πÄ‡∏≠‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á";
        if (wpm <= 65) return "üöÄ ‡πÇ‡∏´‡∏î‡∏à‡∏±‡∏î‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢ ‡πÅ‡∏°‡πà‡πÄ‡∏¢‡πá‡∏î";
        if (wpm <= 75) return "üëΩ ‡∏™‡∏∏‡∏î‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡πà‡∏∞‡πÉ‡∏Ñ‡∏£‡∏à‡∏∞‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏°‡∏∂‡∏á";
        if (wpm <= 85) return "üëΩ ‡πÄ‡∏≠‡∏≤‡πÄ‡∏ñ‡∏≠‡∏∞ ‡∏°‡∏∂‡∏á‡∏Å‡πá‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏™‡∏±‡∏™";
        return "üëΩ ‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÇ‡∏Å‡πâ‡∏á‡∏ï‡∏∂‡∏á‡πÜ ‡πÉ‡∏Ñ‡∏£‡∏à‡∏∞‡πÑ‡∏´‡∏ß";
    }

    function handleAuth() {
        const user = document.getElementById('usernameInput').value.trim();
        const pass = document.getElementById('passwordInput').value.trim();
        if(!user || !pass) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!");
        let db = JSON.parse(localStorage.getItem('typingDB_Final') || '{}');
        if(db[user] && db[user].pass !== pass) return alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î!");
        if(!db[user]) db[user] = { pass: pass, best: 0 };
        localStorage.setItem('typingDB_Final', JSON.stringify(db));
        localStorage.setItem('isLoggedIn', user);
        currentUser = user;
        showGame(user, db[user].best);
    }

    function showGame(user, best) {
        document.getElementById('displayUser').innerText = user;
        document.getElementById('bestWPM').innerText = best;
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('gameMain').style.display = 'block';
        init();
    }

    function handleLogout() {
        localStorage.removeItem('isLoggedIn');
        location.reload();
    }

    function showRanking() {
        document.getElementById('lbBody').innerHTML = "<tr><td colspan='4' style='text-align:center'>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>";
        document.getElementById('rankingModal').style.display = 'flex';

        fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
            data.sort((a, b) => b.wpm - a.wpm);
            let html = "";
            data.slice(0, 50).forEach((row, i) => {
                html += `<tr class="${row.username === currentUser ? 'active-rank' : ''}">
                    <td>${i+1}</td>
                    <td>${row.username}</td>
                    <td>${row.wpm}</td>
                    <td>${getRank(row.wpm)}</td>
                </tr>`;
            });
            document.getElementById('lbBody').innerHTML = html || "<tr><td colspan='4'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>";
        })
        .catch(() => {
            document.getElementById('lbBody').innerHTML = "<tr><td colspan='4'>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</td></tr>";
        });
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function init() {
        words = [...fullWordList].sort(() => Math.random() - 0.5);
        document.getElementById('wordContainer').innerHTML = words.map((w, i) => `<span class="word" id="w-${i}">${w}</span>`).join('');
        currentIdx = 0; timeLeft = 60; isStarted = false; 
        correctCount = 0; wrongCount = 0; totalTypeAttempts = 0; totalChars = 0; correctChars = 0;
        document.getElementById('userInput').value = '';
        document.getElementById('userInput').disabled = false;
        document.getElementById('timer').innerText = 60;
        document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
        document.getElementById('wordContainer').style.transform = `translateY(0)`;
        updateFocus();
    }

    function updateFocus() {
        document.querySelectorAll('.word.current').forEach(el => el.classList.remove('current'));
        const active = document.getElementById(`w-${currentIdx}`);
        if(active) {
            active.classList.add('current');
            if(active.offsetTop > 40) document.getElementById('wordContainer').style.transform = `translateY(-${active.offsetTop - 10}px)`;
        }
    }

    document.getElementById('userInput').addEventListener('input', () => {
        if(!isStarted && document.getElementById('userInput').value.length > 0) {
            isStarted = true;
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                if(timeLeft <= 0) endGame();
            }, 1000);
        }
    });

    document.getElementById('userInput').addEventListener('keydown', (e) => {
        if(e.key === ' ' || e.key === 'Enter') {
            e.preventDefault();
            const val = document.getElementById('userInput').value.trim();
            if(!val) return;
            
            totalTypeAttempts++; // ‡∏ô‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏™‡πà‡∏á
            const target = words[currentIdx];
            totalChars += target.length;
            
            if(val === target) { 
                document.getElementById(`w-${currentIdx}`).classList.add('correct'); 
                correctCount++; 
                correctChars += target.length; 
            } else { 
                document.getElementById(`w-${currentIdx}`).classList.add('wrong'); 
                wrongCount++;
            }
            currentIdx++; document.getElementById('userInput').value = '';
            updateFocus();
        }
    });

    function endGame() {
        clearInterval(timer);
        document.getElementById('userInput').disabled = true;
        const finalAcc = totalChars > 0 ? Math.round((correctChars/totalChars)*100) : 0;
        const rankMessage = getRank(correctCount);
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Best ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
        let db = JSON.parse(localStorage.getItem('typingDB_Final'));
        if(correctCount > db[currentUser].best) {
            db[currentUser].best = correctCount;
            localStorage.setItem('typingDB_Final', JSON.stringify(db));
            document.getElementById('bestWPM').innerText = correctCount;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô Modal
        document.getElementById('resWpm').innerText = correctCount;
        document.getElementById('resAcc').innerText = finalAcc + "%";
        document.getElementById('resCorrect').innerText = correctCount;
        document.getElementById('resWrong').innerText = wrongCount;
        document.getElementById('resAttempts').innerText = totalTypeAttempts;
        document.getElementById('resRankBadge').innerText = rankMessage;
        document.getElementById('resultModal').style.display = 'flex';
        document.getElementById('syncStatus').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏∞‡πÑ‡∏≠‡πâ‡∏™‡∏±‡∏™";

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Payload ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        const payload = {
            username: currentUser,
            wpm: correctCount,
            accuracy: finalAcc,
            correctWords: correctCount,
            wrongWords: wrongCount,
            totalAttempts: totalTypeAttempts,
            rank: rankMessage
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        })
        .then(() => {
            document.getElementById('syncStatus').innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÅ‡∏°‡πà‡πÄ‡∏¢‡πá‡∏î";
        })
        .catch(() => {
            document.getElementById('syncStatus').innerText = "‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏¢ " + rankMessage;
        });
    }

    function resetGame() { 
        clearInterval(timer); 
        init(); 
        setTimeout(() => document.getElementById('userInput').focus(), 100); 
    }
</script>
</body>
</html>
